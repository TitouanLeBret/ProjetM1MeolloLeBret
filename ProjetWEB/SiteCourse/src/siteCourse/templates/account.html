{% extends 'squelette.html' %}
{% load static %}
{% block title %}Compte{% endblock %}
{% block content %}

<div class="grid items-center justify-center min-h-screen bg-gray-100 py-8">
    {% if user.is_authenticated %}
        <form method="POST" action="" enctype="multipart/form-data">
            <h1 class="text-3xl font-bold text-center text-gray-700 mb-6">Votre compte :</h1>
            {% csrf_token %}
            {{form}}
            <button type="submit" class="w-full bg-neutral-600 hover:bg-neutral-800 text-white font-bold py-2 px-4 rounded-md transition duration-300">Enregistrer les modifications</button>

            <!-- Bouton de suppression du compte-->
            <button class="flex items-center w-full bg-neutral-600 hover:bg-neutral-800 text-red-600 font-bold py-2 px-4 rounded-md transition duration-300 mt-4"
                    onclick="delete_account('{{ inscription.id }}')">
                <img src="{% static 'images/logo_croix_grise.png' %}" alt="Supprimer_compte" class="w-6 h-6 mr-2">
                <span>Supprimer mon compte</span>
            </button>

            {% if success %}
                <div class="bg-green-100 text-green-700 p-4 rounded mb-6 mt-6">
                    <p>Modification(s) validée(s) !</p>
                </div>
            {% endif %}


        </form>
    {% else %}
        <h1>Mon compte (non connecté)</h1>
        <p>Vous devez être connecté pour accéder à cette page.</p>
    {% endif %}
</div>




<!-- Gestion du boutton de suppression d'un compte en JS -->
<!--

On demande confirmation dans pop up


-->
<script>
    function delete_account(userId) {
        // Afficher une pop de confirmation
        const confirmation = confirm(
            "Êtes-vous sûr de vouloir supprimer Votre Compte ? "
        );
        if (confirmation) {
            //Effectuer la suppression dans la BDD, et renvoyer vers une page inscription supprimer (ou un message)
            // Créer un formulaire de suppression
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'supprimer/';  // L'URL de votre vue Django pour supprimer l'inscription

            // Ajouter le CSRF token pour sécuriser le formulaire
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = document.querySelector('[name=csrfmiddlewaretoken]').value;

            // Ajouter l'ID de l'inscription
            const idInput = document.createElement('input');
            idInput.type = 'hidden';
            idInput.name = 'inscription_id';
            idInput.value = inscriptionId;

            // Ajouter les champs au formulaire
            form.appendChild(csrfInput);
            form.appendChild(idInput);

            // Ajouter le formulaire à la page et soumettre
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>

{% endblock %}